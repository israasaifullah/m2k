# T-134: Add lag metrics tracking (frame drops, buffer)

**Epic:** EPIC-024

## Description
Implement metrics collection for terminal performance. Track frame drops, buffer size, throttle state, and render time. Useful for ongoing optimization and debugging.

## Acceptance Criteria
- Track metrics:
  - Frontend buffer size (bytes)
  - Frame drops (missed 16ms flush windows)
  - Current throttle delay (ms)
  - xterm.write() duration (ms)
- Store in-memory (rolling window, last 60s)
- Expose via dev tools console: `window.__terminalMetrics`
- Optional: Display in settings/debug panel

## Technical Notes
**File:** `src/components/Terminal.tsx`

**Approach:**
```typescript
interface Metrics {
  bufferSize: number[];
  frameDrops: number;
  throttleDelay: number[];
  writeDuration: number[];
  timestamp: number[];
}

const metrics: Metrics = {
  bufferSize: [],
  frameDrops: 0,
  throttleDelay: [],
  writeDuration: [],
  timestamp: []
};

const flushBuffer = () => {
  const start = performance.now();
  xterm.write(writeBuffer);
  const duration = performance.now() - start;

  metrics.writeDuration.push(duration);
  metrics.bufferSize.push(writeBuffer.length);
  metrics.timestamp.push(Date.now());

  // Keep last 60s
  const cutoff = Date.now() - 60000;
  const idx = metrics.timestamp.findIndex(t => t > cutoff);
  if (idx > 0) {
    Object.keys(metrics).forEach(k => metrics[k] = metrics[k].slice(idx));
  }
};

window.__terminalMetrics = metrics;
```

## Dependencies
- None

## Testing
- Run heavy output
- Check `window.__terminalMetrics` in console
- Verify metrics are collected
- Confirm 60s retention window
